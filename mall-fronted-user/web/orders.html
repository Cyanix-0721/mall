<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="renderer" content="webkit">
	<title>电脑商城</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="../bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">
	<script src="../bootstrap3/jquery-1.9.1.min.js"></script>
	<script src="../bootstrap3/js/bootstrap.js"></script>
	<link rel="stylesheet" href="../bootstrap3/font-awesome-4.7.0/css/font-awesome.css">
	<link rel="stylesheet" type="text/css" href="../css/layout.css">
	<link rel="stylesheet" type="text/css" href="../css/top.css">
	<link rel="stylesheet" type="text/css" href="../css/footer.css">
	<link rel="stylesheet" type="text/css" href="../css/order.css">
</head>

<body>
	<!-- 头部 -->
	<header class="header">
		<div class="row">
			<div class="col-md-3">
				<a href="index.html">
					<img src="../images/index/1.png" width="250px" />
				</a>
			</div>
			<div class="col-md-9 top-item">
				<ul class="list-inline pull-right">
					<li><a href="favorites.html"><span class="fa fa-heart"></span>&nbsp;收藏</a></li>
					<li class="li-split">|</li>
					<li><a href="orders.html"><span class="fa fa-file-text"></span>&nbsp;订单</a></li>
					<li class="li-split">|</li>
					<li><a href="cart.html"><span class="fa fa-cart-plus"></span>&nbsp;购物车</a></li>
					<li class="li-split">|</li>
					<li>
						<div class="btn-group">
							<button type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown">
								<span id="top-dropdown-btn"><span class="fa fa-gears"></span>&nbsp;管理 <span
										class="caret"></span></span>
							</button>
							<ul class="dropdown-menu top-dropdown-ul" role="menu">
								<li><a href="password.html">修改密码</a></li>
								<li><a href="userdata.html">个人资料</a></li>
								<li><a href="upload.html">上传头像</a></li>
								<li><a href="address.html">收货管理</a></li>
							</ul>
						</div>
					</li>
					<li class="li-split">|</li>
					<li><a href="login.html"><span class="fa fa-user"></span>&nbsp;<span
								id="member-username"></span></a></li>
				</ul>
			</div>
		</div>
	</header>
	<!-- 导航 -->
	<div class="row top-nav">
		<div class="col-md-6">
			<ul class="nav nav-pills">
				<li class="active"><a href="index.html"><span class="fa fa-home"></span></a></li>
				<li><a href="#">秒杀</a></li>
				<li><a href="#">优惠券</a></li>
			</ul>
		</div>
		<div class="col-md-6">
			<form action="search.html" class="form-inline pull-right" role="form">
				<div class="form-group">
					<input type="text" class="form-control" id="search" name="search" placeholder="请输入商品名称进行搜索">
				</div>
				<button type="submit" class="btn btn-default btn-sm"><span class="fa fa-search"></span></button>
			</form>
		</div>
	</div>

	<!-- 主体内容 -->
	<div class="container">
		<div class="col-md-2">
			<!-- 左侧导航省略 -->
		</div>
		<div class="col-md-10">
			<div class="panel panel-default">
				<div class="panel-heading">
					<p class="panel-title">我的订单</p>
				</div>
				<div class="panel-body">
					<table class="orders-table" width="100%">
						<thead>
							<tr>
								<th width="10%">ID</th>
								<th width="10%">订单号</th>
								<th width="10%">订单ID</th>
								<th width="10%">商品ID</th>
								<th width="6%">商品图片</th>
								<th width="20%">商品名称</th>
								<th width="8%">支付金额</th>
								<th width="8%">备注</th>
								<th width="10%">售后</th>
								<th width="12%">会员名称</th> <!-- 新增会员名称列 -->
								<th width="14%">状态</th>
								<th width="8%">操作</th>
							</tr>
						</thead>
						<tbody class="orders-body">
							<!-- 订单内容动态生成 -->
						</tbody>
					</table>
					<div>
						<span class="pull-right total-amount"></span>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!--页脚开始-->
	<footer class="footer">
		<!-- 品质保障，私人定制等-->
		<div class="text-center rights container">
			<div class="col-md-offset-2 col-md-2">
				<span class="fa fa-thumbs-o-up"></span>
				<p>品质保障</p>
			</div>
			<div class="col-md-2">
				<span class="fa fa-address-card-o"></span>
				<p>私人订制</p>
			</div>
			<div class="col-md-2">
				<span class="fa fa-graduation-cap"></span>
				<p>学生特供</p>
			</div>
			<div class="col-md-2">
				<span class="fa fa-bitcoin"></span>
				<p>专属特权</p>
			</div>
		</div>
		<!--联系我们、下载客户端等-->
		<div class="container beforeBottom">
			<div class="col-md-offset-1 col-md-3">
				<div><img src="../images/index/1.png" alt="" class="footLogo" width="150px" /></div>
				<div><img src="../images/index/footerFont.png" alt="" /></div>
			</div>
			<div class="col-md-4 callus text-center">
				<div class="col-md-4">
					<ul>
						<li>
							<a href="#">
								<p>买家帮助</p>
							</a>
						</li>
						<li><a href="#">新手指南</a></li>
						<li><a href="#">服务保障</a></li>
						<li><a href="#">常见问题</a></li>
					</ul>
				</div>
				<div class="col-md-4">
					<ul>
						<li>
							<a href="#">
								<p>商家帮助</p>
							</a>
						</li>
						<li><a href="#">商家入驻</a></li>
						<li><a href="#">商家后台</a></li>
					</ul>
				</div>
				<div class="col-md-4">
					<ul>
						<li>
							<a href="#">
								<p>关于我们</p>
							</a>
						</li>
						<li><a href="#">关于圆心</a></li>
						<li><a href="#">联系我们</a></li>
						<li>
							<span class="fa fa-wechat"></span>
							<span class="fa fa-weibo"></span>
						</li>
					</ul>
				</div>
			</div>
			<div class="col-md-4">
				<div class="col-md-5">
					<p>电商平台客户端</p>
					<img src="../images/index/ios.png" class="lf">
					<img src="../images/index/android.png" alt="" class="lf" />
				</div>
				<div class="col-md-6">
					<img src="../images/index/1.png" width="150px">
				</div>
			</div>
		</div>

	</footer>

	<!-- JavaScript -->
	<script>
		$(document).ready(function () {
			var page = 1;
			var pageSize = 10;

			function fetchOrders() {
				$.ajax({
					url: "http://localhost:8080/OrderItem/list",
					method: "GET",
					data: {
						page: page,
						size: pageSize
					},
					dataType: "json",
					success: function (response) {
						console.log("Response received:", response); // 打印完整响应
						if (response && response.records && Array.isArray(response.records)) {
							var orders = response.records;
							var ordersBody = $(".orders-body");
							ordersBody.empty();
							var totalAmount = 0;

							orders.forEach(function (order) {
								var row = "<tr>" +
									"<td>" + order.id + "</td>" +
									"<td>" + order.orderSn + "</td>" +
									"<td>" + order.orderId + "</td>" +
									"<td>" + order.productId + "</td>" +
									"<td><img src='" + order.productPic + "' alt='商品图片' width='50'></td>" +
									"<td>" + order.productName + "</td>" +
									"<td>¥<span>" + order.payAmount + "</span></td>" +
									"<td>" + order.note + "</td>" +
									"<td><a href='#' class='apply-return' data-order-sn='" + order.orderSn + "' data-order-id='" + order.orderId + "' data-product-id='" + order.productId + "' data-product-pic='" + order.productPic + "' data-product-name='" + order.productName + "' data-pay-amount='" + order.payAmount + "' data-note='" + order.note + "' data-member-username='" + order.memberUsername + "'>申请售后</a></td>" +
									"<td>" + order.memberUsername + "</td>" + // 显示会员名称
									"<td>" + order.status + "</td>" +
									"<td><a href='#' class='btn btn-default btn-xs'>确认收货</a></td>" +
									"</tr>";
								ordersBody.append(row);
								totalAmount += parseFloat(order.payAmount);
							});

							$(".total-amount").text("订单总金额：¥" + totalAmount.toFixed(2));
						} else {
							console.log("No data found");
						}
					},
					error: function (xhr, status, error) {
						console.error("Error fetching orders:", error);
					}
				});
			}

			function submitReturnApply(orderData) {
				$.ajax({
					url: "http://localhost:8080/returnApply/submit",
					method: "POST",
					contentType: "application/json",
					data: JSON.stringify(orderData),
					success: function (response) {
						alert("退货申请提交成功！");
					},
					error: function (xhr, status, error) {
						console.error("Error submitting return apply:", error);
						alert("提交退货申请失败！");
					}
				});
			}

			$(document).on("click", ".apply-return", function (e) {
				e.preventDefault();
				var orderSn = $(this).data("order-sn");
				var orderId = $(this).data("order-id");
				var productId = $(this).data("product-id");
				var productPic = $(this).data("product-pic");
				var productName = $(this).data("product-name");
				var payAmount = $(this).data("pay-amount");
				var note = $(this).data("note");
				var memberUsername = $(this).data("member-username");

				var orderData = {
					orderSn: orderSn,
					orderId: orderId,
					productId: productId,
					productPic: productPic,
					productName: productName,
					payAmount: payAmount,
					note: note,
					memberUsername: memberUsername // 包含 memberUsername
				};

				submitReturnApply(orderData);
			});

			fetchOrders();
		});
	</script>
</body>

</html>